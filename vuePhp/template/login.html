<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Welcome to Vuetify</title>
  <link href='https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Material+Icons' rel="stylesheet" type="text/css">
  <link href="https://unpkg.com/vuetify/dist/vuetify.min.css" rel="stylesheet" type="text/css"></link>
  <link href="styles.css" rel="stylesheet" type="text/css">
  <link rel="icon" type="image/png" href="favicon-32x32.png" sizes="32x32">
</head>
<body>
    <div id="app">
        <v-app>

    <script type="text/x-template" id="grid-template">
      <div>
          <v-card>
              <v-data-table
                  v-bind:headers="headers"
                  v-bind:items="items"
                  v-bind:search="search"
                >
                <template slot="items" scope="props">
                  <td>
                    <v-edit-dialog
                      lazy
                    > {{ props.item.name }}
                      <v-text-field
                        slot="input"
                        label="Edit"
                        v-model="props.item.name"
                        single-line
                        counter
                        :rules="[max25chars]"
                      ></v-text-field>
                    </v-edit-dialog>
                  </td>
                  <td class="text-xs-right">{{ props.item.calories }}</td>
                  <td class="text-xs-right">{{ props.item.fat }}</td>
                  <td class="text-xs-right">{{ props.item.carbs }}</td>
                  <td class="text-xs-right">{{ props.item.protein }}</td>
                  <td class="text-xs-right">{{ props.item.sodium }}</td>
                  <td class="text-xs-right">{{ props.item.calcium }}</td>
                  <td class="text-xs-right">
                    <v-edit-dialog
                      @open="tmp = props.item.iron"
                      @save="props.item.iron = tmp || props.item.iron"
                      large
                      lazy
                    >
                      <div>{{ props.item.iron }}</div>
                      <div slot="input" class="mt-3 title">Update Iron</div>
                      <v-text-field
                        slot="input"
                        label="Edit"
                        v-model="tmp"
                        single-line
                        counter
                        autofocus
                        :rules="[max25chars]"
                      ></v-text-field>
                    </v-edit-dialog>
                  </td>
                </template>
                <template slot="pageText" scope="{ pageStart, pageStop }">
                  From {{ pageStart }} to {{ pageStop }}
                </template>
              </v-data-table>

        <table>
        <thead>
          <tr>
            <th v-for="key in columns"
              @click="sortBy(key)"
              :class="{ active: sortKey == key }">
              {{ key | capitalize }}
              <span class="arrow" :class="sortOrders[key] > 0 ? 'asc' : 'dsc'">
              </span>
            </th>
          </tr>
        </thead>
        <tbody>
          <tr v-for="entry in filteredData">
            <td v-for="key in columns">
              {{entry[key]}}
            </td>
          </tr>
        </tbody>
      </table>
      </div>
      
    </script>
    
    <!-- demo root element -->
    <div id="demo">
        <v-card>
            <v-card-title>
              Nutrition
              <v-spacer></v-spacer>
              <v-text-field
                append-icon="search"
                label="Search"
                single-line
                hide-details
                v-model="searchQuery"
              ></v-text-field>
            </v-card-title>
          </v-card>

      <form id="search">
        Search <input name="query" v-model="searchQuery">
      </form>
      <demo-grid
        :data="gridData"
        :columns="gridColumns"
        :filter-key="searchQuery">
      </demo-grid>
    </div>

    </v-app>
  </div>

  <script src="https://unpkg.com/vue/dist/vue.js"></script>
  <script src="https://unpkg.com/vuetify/dist/vuetify.js"></script>
  <script>
   // register the grid component
   Vue.component('demo-grid', {
     template: '#grid-template',
     props: {
       data: Array,
       columns: Array,
       filterKey: String
     },
     data: function () {
       var sortOrders = {}
       this.columns.forEach(function (key) {
         sortOrders[key] = 1
       })
       return {
         sortKey: '',
         sortOrders: sortOrders
       }
     },
     computed: {
       filteredData: function () {
         var sortKey = this.sortKey
         var filterKey = this.filterKey && this.filterKey.toLowerCase()
         var order = this.sortOrders[sortKey] || 1
         var data = this.data
         if (filterKey) {
           data = data.filter(function (row) {
             return Object.keys(row).some(function (key) {
               return String(row[key]).toLowerCase().indexOf(filterKey) > -1
             })
           })
         }
         if (sortKey) {
           data = data.slice().sort(function (a, b) {
             a = a[sortKey]
             b = b[sortKey]
             return (a === b ? 0 : a > b ? 1 : -1) * order
           })
         }
         return data
       }
     },
     filters: {
       capitalize: function (str) {
         return str.charAt(0).toUpperCase() + str.slice(1)
       }
     },
     methods: {
       sortBy: function (key) {
         this.sortKey = key
         this.sortOrders[key] = this.sortOrders[key] * -1
       }
     }
   })
   
   // bootstrap the demo
   var demo = new Vue({
     el: '#demo',
     data: {
       searchQuery: '',
       gridColumns: ['name', 'power'],
       gridData: [
         { name: 'Chuck Norris', power: Infinity },
         { name: 'Bruce Lee', power: 9000 },
         { name: 'Jackie Chan', power: 7000 },
         { name: 'Jet Li', power: 8000 }
       ]
     }
   })
  </script>
</body>
</html>
